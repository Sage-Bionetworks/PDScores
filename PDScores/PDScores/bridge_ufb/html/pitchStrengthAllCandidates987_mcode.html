<pre class="code">
<span class="srcline"><span class="lineno"><a href="160,177" id="srcline177">177</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,178" id="srcline178">178</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S79T27U1060">S</span> = pitchStrengthAllCandidates( <span class="var type1" id="S80T3U1063">f</span>, <span class="var type1" id="S81T27U1064">L</span>, <span class="var type1" id="S82T27U1065">pc</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="160,179" id="srcline179">179</a></span><span class="line"><span class="comment">% Create pitch strength matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo " id="T27:U5"><span class="var type1" id="S79T27U1068">S</span> = <span class="mxinfo " id="T27:U7">zeros( <span class="mxinfo " id="T1:U8">length(<span class="var type1" id="S82T27U1073">pc</span>)</span>, <span class="mxinfo " id="T1:U10">size(<span class="var type1" id="S81T27U1076">L</span>,2)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,181" id="srcline181">181</a></span><span class="line"><span class="comment">% Define integration regions</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo " id="T24:U12"><span class="var type1" id="S86T24U1080">k</span> = <span class="mxinfo " id="T24:U14">ones( <span class="mxinfo " id="T1:U15">1</span>, <span class="mxinfo " id="T1:U16"><span class="mxinfo " id="T1:U17">length(<span class="var type1" id="S82T27U1087">pc</span>)</span>+<span class="mxinfo " id="T1:U19">1</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,183" id="srcline183">183</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S88T1U1091">j</span> = <span class="mxinfo " id="T1:U21">1</span> : <span class="mxinfo " id="T1:U22"><span class="mxinfo " id="T1:U23">length(<span class="var type1" id="S86T24U1097">k</span>)</span>-<span class="mxinfo " id="T1:U25">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,184" id="srcline184">184</a></span><span class="line">    <span class="mxinfo " id="T1:U26"><span class="mxinfo " id="T1:U27"><span class="var type1" id="S86T24U1102">k</span>(<span class="mxinfo " id="T1:U29"><span class="var type1" id="S88T1U1104">j</span>+<span class="mxinfo " id="T1:U31">1</span></span>)</span> = <span class="mxinfo " id="T114:U32"><span class="mxinfo " id="T1:U33"><span class="mxinfo " id="T1:U34"><span class="var type1" id="S86T24U1109">k</span>(<span class="var type1" id="S88T1U1110">j</span>)</span> - <span class="mxinfo " id="T1:U37">1</span></span> + <span class="mxinfo " id="T114:U38">find( <span class="mxinfo " id="T42:U39"><span class="mxinfo " id="T3:U40"><span class="var type1" id="S80T3U1116">f</span>(<span class="mxinfo " id="T1:U42"><span class="var type1" id="S86T24U1119">k</span>(<span class="var type1" id="S88T1U1120">j</span>)</span>:<span class="mxinfo " id="T1:U45">end</span>)</span> &gt; <span class="mxinfo " id="T1:U46"><span class="mxinfo " id="T1:U47"><span class="var type1" id="S82T27U1125">pc</span>(<span class="var type1" id="S88T1U1126">j</span>)</span>/<span class="mxinfo " id="T1:U50">4</span></span></span>, 1, <span class="string">'first'</span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,185" id="srcline185">185</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,186" id="srcline186">186</a></span><span class="line"><span class="mxinfo " id="T24:U51"><span class="var type1" id="S86T24U1132">k</span> = <span class="mxinfo " id="T24:U53"><span class="var type1" id="S86T24U1134">k</span>(<span class="mxinfo " id="T1:U55">2</span>:<span class="mxinfo " id="T1:U56">end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,187" id="srcline187">187</a></span><span class="line"><span class="comment">% Create loudness normalization matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,188" id="srcline188">188</a></span><span class="line"><span class="mxinfo " id="T27:U57"><span class="var type1" id="S91T27U1141">N</span> = <span class="mxinfo " id="T27:U59">sqrt( <span class="mxinfo " id="T27:U60">flipud( <span class="mxinfo " id="T27:U61">cumsum( <span class="mxinfo " id="T27:U62">flipud(<span class="mxinfo " id="T27:U63"><span class="var type1" id="S81T27U1151">L</span>.*<span class="var type1" id="S81T27U1152">L</span></span>)</span> )</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,189" id="srcline189">189</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S88T1U1155">j</span> = <span class="mxinfo " id="T1:U67">1</span> : <span class="mxinfo " id="T1:U68">length(<span class="var type1" id="S82T27U1160">pc</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,190" id="srcline190">190</a></span><span class="line">    <span class="comment">% Normalize loudness</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,191" id="srcline191">191</a></span><span class="line">    <span class="mxinfo " id="T24:U70"><span class="var type1" id="S95T24U1163">n</span> = <span class="mxinfo " id="T24:U72"><span class="var type1" id="S91T27U1165">N</span>(<span class="mxinfo " id="T1:U74"><span class="var type1" id="S86T24U1167">k</span>(<span class="var type1" id="S88T1U1168">j</span>)</span>,:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,192" id="srcline192">192</a></span><span class="line">    <span class="mxinfo " id="T24:U77"><span class="mxinfo " id="T24:U78"><span class="var type1" id="S95T24U1173">n</span>(<span class="mxinfo " id="T55:U80"><span class="var type1" id="S95T24U1175">n</span>==<span class="mxinfo " id="T1:U82">0</span></span>)</span> = <span class="mxinfo " id="T1:U83">Inf</span></span>; <span class="comment">% to make zero-loudness equal zero after normalization</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,193" id="srcline193">193</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="160,194" id="srcline194">194</a></span><span class="line"><span class="comment">%     NL = L(k(j):end,:) ./ repmat( n, size(L,1)-k(j)+1, 1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,195" id="srcline195">195</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="160,196" id="srcline196">196</a></span><span class="line">    <span class="mxinfo " id="T1:U84"><span class="var type1" id="S97T1U1181">rowIdx</span> = (<span class="mxinfo " id="T1:U86">1:size(<span class="var type1" id="S95T24U1188">n</span>,1)</span>)'</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,197" id="srcline197">197</a></span><span class="line">    <span class="mxinfo " id="T3:U88"><span class="var type1" id="S98T3U1192">colIdx</span> = <span class="mxinfo " id="T3:U90">(<span class="mxinfo " id="T24:U91">1:<span class="mxinfo " id="T1:U92">size(<span class="var type1" id="S95T24U1199">n</span>,2)</span></span>)'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,198" id="srcline198">198</a></span><span class="line"><span class="comment">%     NL = L(k(j):end,:) ./ n(rowIdx(:,ones(size(L,1)-k(j)+1,1)), colIdx(:,1));</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,199" id="srcline199">199</a></span><span class="line">    <span class="mxinfo " id="T27:U94"><span class="var type1" id="S99T27U1203">NL</span> = <span class="mxinfo " id="T27:U96"><span class="mxinfo " id="T27:U97"><span class="var type1" id="S81T27U1206">L</span>(<span class="mxinfo " id="T2:U99"><span class="mxinfo " id="T1:U100"><span class="var type1" id="S86T24U1209">k</span>(<span class="var type1" id="S88T1U1210">j</span>)</span>:<span class="mxinfo " id="T1:U103">end</span></span>,:)</span> ./ <span class="mxinfo " id="T27:U104"><span class="var type1" id="S95T24U1215">n</span>(<span class="mxinfo " id="T3:U106"><span class="mxinfo " id="T1:U107"><span class="var type1" id="S97T1U1217">rowIdx</span></span>(:,<span class="mxinfo " id="T3:U109">ones(<span class="mxinfo " id="T1:U110"><span class="mxinfo " id="T1:U111"><span class="mxinfo " id="T1:U112">size(<span class="var type1" id="S81T27U1225">L</span>,1)</span>-<span class="mxinfo " id="T1:U114"><span class="var type1" id="S86T24U1228">k</span>(<span class="var type1" id="S88T1U1229">j</span>)</span></span>+<span class="mxinfo " id="T1:U117">1</span></span>,1)</span>)</span>, <span class="var type1" id="S98T3U1232">colIdx</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,200" id="srcline200">200</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="160,201" id="srcline201">201</a></span><span class="line">    <span class="comment">% Compute pitch strength</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,202" id="srcline202">202</a></span><span class="line">    <span class="mxinfo " id="T24:U119"><span class="mxinfo " id="T24:U120"><span class="var type1" id="S79T27U1236">S</span>(<span class="var type1" id="S88T1U1237">j</span>,:)</span> = <span class="mxinfo " id="T24:U123"><span class="fcn" id="F986N20:B1240">pitchStrengthOneCandidate</span>( <span class="mxinfo " id="T3:U124"><span class="var type1" id="S80T3U1242">f</span>(<span class="mxinfo " id="T1:U126"><span class="var type1" id="S86T24U1245">k</span>(<span class="var type1" id="S88T1U1246">j</span>)</span>:<span class="mxinfo " id="T1:U129">end</span>)</span>, <span class="var type1" id="S99T27U1249">NL</span>, <span class="mxinfo " id="T1:U131"><span class="var type1" id="S82T27U1251">pc</span>(<span class="var type1" id="S88T1U1252">j</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,203" id="srcline203">203</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,204" id="srcline204">204</a></span><span class="line"></span></span>
</pre>
